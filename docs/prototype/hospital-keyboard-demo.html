<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>医院员工自助终端 · 虚拟键盘 Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.prod.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --key-char-bg: #3a3f4b;
        --key-char-hover: #454b59;
        --key-char-active-scale: 0.91;
        --key-fn-bg: #2a2e38;
        --key-fn-hover: #333845;
        --key-confirm-bg: #1d5fcc;
        --key-confirm-hover: #1a52b8;
        --kbd-bg: #1e2130;
        --kbd-bar-bg: #181b27;
        --kbd-shadow:
          0 -8px 40px rgba(0, 0, 0, 0.5), 0 -2px 0 rgba(255, 255, 255, 0.04);
      }

      body {
        font-family: "Noto Sans SC", sans-serif;
        background: #eef2f7;
        min-height: 100vh;
        min-width: 768px;
        overflow-x: hidden;
      }

      .mono {
        font-family: "JetBrains Mono", monospace;
      }

      /* ── 背景网格 ── */
      .bg-grid {
        background-color: #eef2f7;
        background-image:
          linear-gradient(rgba(59, 130, 246, 0.045) 1px, transparent 1px),
          linear-gradient(90deg, rgba(59, 130, 246, 0.045) 1px, transparent 1px);
        background-size: 36px 36px;
      }

      /* ── 状态栏 ── */
      .status-bar {
        background: linear-gradient(
          135deg,
          #0d1b3e 0%,
          #1a3a6b 60%,
          #0f3460 100%
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.07);
      }

      /* ── 登录卡片 ── */
      .login-card {
        background: rgba(255, 255, 255, 0.97);
        border: 1px solid rgba(220, 228, 240, 0.9);
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.05),
          0 20px 60px -10px rgba(13, 27, 62, 0.12);
      }
      .card-accent {
        background: linear-gradient(90deg, #2563eb, #38bdf8, #2563eb);
        background-size: 200%;
        animation: gradShift 4s ease infinite;
      }
      @keyframes gradShift {
        0%,
        100% {
          background-position: 0%;
        }
        50% {
          background-position: 100%;
        }
      }

      /* ── 输入框 ── */
      .kiosk-input {
        border: 1.5px solid #e2e8f0;
        background: #f8fafc;
        transition:
          border-color 0.18s,
          box-shadow 0.18s,
          background 0.18s;
        cursor: pointer;
        caret-color: transparent;
        user-select: none;
      }
      .kiosk-input:focus,
      .kiosk-input.focused {
        outline: none;
        border-color: #3b82f6;
        background: #fff;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.13);
      }
      .kiosk-input::placeholder {
        color: #94a3b8;
      }

      /* 光标闪烁 */
      .input-cursor::after {
        content: "";
        display: inline-block;
        width: 2px;
        height: 1.1em;
        background: #3b82f6;
        margin-left: 1px;
        vertical-align: text-bottom;
        animation: blink 0.9s step-end infinite;
      }
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
      }

      /* ── 登录按钮 ── */
      .btn-login {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        transition: all 0.2s;
      }
      .btn-login:not(:disabled):hover {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        box-shadow: 0 8px 25px -5px rgba(37, 99, 235, 0.45);
        transform: translateY(-1px);
      }
      .btn-login:not(:disabled):active {
        transform: translateY(0);
        box-shadow: none;
      }
      .btn-login:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* ── NFC ── */
      @keyframes nfc-ring {
        0% {
          transform: scale(0.85);
          opacity: 0.9;
        }
        100% {
          transform: scale(1.9);
          opacity: 0;
        }
      }
      .nfc-ring {
        animation: nfc-ring 2.2s ease-out infinite;
      }
      .nfc-ring:nth-child(2) {
        animation-delay: 0.6s;
      }
      .nfc-ring:nth-child(3) {
        animation-delay: 1.2s;
      }
      @keyframes nfc-breathe {
        0%,
        100% {
          border-color: #93c5fd;
          background: linear-gradient(135deg, #eff6ff, #f0f9ff);
        }
        50% {
          border-color: #3b82f6;
          background: linear-gradient(135deg, #dbeafe, #e0f2fe);
        }
      }
      .nfc-zone {
        border: 2.5px dashed #93c5fd;
        animation: nfc-breathe 3s ease-in-out infinite;
      }

      /* ── Spinner ── */
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .spinner {
        animation: spin 0.75s linear infinite;
      }

      /* ── 状态圆点 ── */
      @keyframes pulse-dot {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(1.35);
        }
      }
      .pulse-dot {
        animation: pulse-dot 1.8s ease-in-out infinite;
      }

      /* ── 键盘滑入/出 ── */
      .kb-enter-active {
        transition:
          transform 0.3s cubic-bezier(0.32, 0.72, 0, 1),
          opacity 0.3s ease;
      }
      .kb-leave-active {
        transition:
          transform 0.22s cubic-bezier(0.4, 0, 1, 1),
          opacity 0.2s ease;
      }
      .kb-enter-from,
      .kb-leave-to {
        transform: translateY(100%);
        opacity: 0;
      }
      .kb-enter-to,
      .kb-leave-from {
        transform: translateY(0);
        opacity: 1;
      }

      /* ── 键盘模式切换 ── */
      .mode-enter-active {
        transition:
          opacity 0.15s ease,
          transform 0.15s ease;
      }
      .mode-leave-active {
        transition:
          opacity 0.12s ease,
          transform 0.12s ease;
      }
      .mode-enter-from {
        opacity: 0;
        transform: translateY(6px);
      }
      .mode-leave-to {
        opacity: 0;
        transform: translateY(-4px);
      }

      /* ── 按键基础 ── */
      .key {
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        font-family: "Noto Sans SC", sans-serif;
        cursor: pointer;
        user-select: none;
        position: relative;
        transition:
          background 0.1s,
          transform 0.08s,
          box-shadow 0.1s;
        box-shadow:
          0 2px 0 rgba(0, 0, 0, 0.35),
          inset 0 1px 0 rgba(255, 255, 255, 0.07);
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }
      .key:active,
      .key.pressing {
        transform: scale(var(--key-char-active-scale)) translateY(1px);
        box-shadow: 0 0px 0 rgba(0, 0, 0, 0.35);
      }
      .key-char {
        background: var(--key-char-bg);
        color: #e8ecf3;
        font-size: 15px;
        font-weight: 500;
      }
      .key-char:hover {
        background: var(--key-char-hover);
      }
      .key-fn {
        background: var(--key-fn-bg);
        color: #9ca8be;
        font-size: 12px;
        font-weight: 600;
      }
      .key-fn:hover {
        background: var(--key-fn-hover);
      }
      .key-confirm {
        background: var(--key-confirm-bg);
        color: #fff;
        font-size: 13px;
        font-weight: 700;
        letter-spacing: 0.05em;
      }
      .key-confirm:hover {
        background: var(--key-confirm-hover);
      }
      .key-space {
        background: var(--key-fn-bg);
        color: #6b7a99;
        font-size: 11px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
      }
      .key-space:hover {
        background: var(--key-fn-hover);
      }
      .key-shift-active {
        background: #1d5fcc !important;
        color: #fff !important;
      }
      .key-shift-caps {
        background: #0f4bbf !important;
        color: #fff !important;
        box-shadow:
          0 2px 0 #0a3a99,
          inset 0 1px 0 rgba(255, 255, 255, 0.12) !important;
      }
      .key-mode-active {
        background: #2a3a5c !important;
        color: #60a5fa !important;
      }
      .key-sym {
        background: #252a3d;
        color: #a5b4fc;
      }
      .key-sym:hover {
        background: #2c3249;
      }
      .key-num {
        background: var(--key-char-bg);
        color: #e8ecf3;
        font-size: 17px;
        font-weight: 600;
      }
      .key-num:hover {
        background: var(--key-char-hover);
      }
      .key-numpad {
        background: var(--key-char-bg);
        color: #e8ecf3;
        font-size: 22px;
        font-weight: 700;
        font-family: "JetBrains Mono", monospace;
      }
      .key-numpad:hover {
        background: var(--key-char-hover);
      }

      /* ── 键盘外壳 ── */
      .keyboard-shell {
        background: var(--kbd-bg);
        box-shadow: var(--kbd-shadow);
        border-radius: 20px 20px 0 0;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 100;
        padding-bottom: env(safe-area-inset-bottom, 0);
      }
      .keyboard-topbar {
        background: var(--kbd-bar-bg);
        border-radius: 20px 20px 0 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* ── 遮罩 ── */
      .kb-overlay {
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(2px);
      }

      /* ── 页面内容上移 ── */
      .page-content {
        transition: padding-bottom 0.3s cubic-bezier(0.32, 0.72, 0, 1);
      }

      /* ── 成功弹窗 ── */
      @keyframes fadeScaleIn {
        from {
          opacity: 0;
          transform: scale(0.92);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .popup-in {
        animation: fadeScaleIn 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }
      @keyframes loadBar {
        from {
          width: 0;
        }
        to {
          width: 100%;
        }
      }

      /* ── 错误抖动 ── */
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-6px);
        }
        40% {
          transform: translateX(6px);
        }
        60% {
          transform: translateX(-4px);
        }
        80% {
          transform: translateX(4px);
        }
      }
      .shake {
        animation: shake 0.38s ease;
      }

      /* 滑动把手 */
      .drag-handle {
        width: 36px;
        height: 4px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 9px;
        margin: 10px auto 0;
      }

      /* 模式标签 */
      .mode-pill {
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        transition:
          background 0.2s,
          color 0.2s;
      }
      .mode-alpha {
        background: rgba(59, 130, 246, 0.18);
        color: #60a5fa;
      }
      .mode-number {
        background: rgba(34, 197, 94, 0.15);
        color: #4ade80;
      }
      .mode-symbol {
        background: rgba(165, 180, 252, 0.18);
        color: #a5b4fc;
      }

      /* 输入预览区 */
      .input-preview {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.07);
        border-radius: 10px;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .slide-up {
        animation: slideUp 0.45s cubic-bezier(0.34, 1.2, 0.64, 1) both;
      }

      /* Shift 图标 */
      .shift-icon-normal {
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
      .shift-icon-caps {
        fill: currentColor;
      }

      /* Tab */
      .tab-btn {
        transition:
          color 0.18s,
          background 0.18s;
      }
      .tab-btn.active {
        background: white;
        color: #2563eb;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
      }
    </style>
  </head>
  <body>
    <div
      id="app"
      :style="{ paddingBottom: kbVisible ? kbHeight + 'px' : '0' }"
      class="page-content"
    >
      <!-- ══════════════ 状态栏 ══════════════ -->
      <header class="status-bar px-6 py-3 sticky top-0 z-20">
        <div class="max-w-5xl mx-auto flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div
              class="w-9 h-9 rounded-xl bg-white/15 border border-white/20 flex items-center justify-center"
            >
              <svg width="19" height="19" viewBox="0 0 24 24" fill="none">
                <path
                  d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"
                  fill="#60a5fa"
                  opacity=".35"
                />
                <rect
                  x="10.5"
                  y="5.5"
                  width="3"
                  height="9"
                  rx="1"
                  fill="white"
                />
                <rect
                  x="7.5"
                  y="8.5"
                  width="9"
                  height="3"
                  rx="1"
                  fill="white"
                />
              </svg>
            </div>
            <div>
              <div class="text-white font-semibold text-sm tracking-wide">
                医院员工自助终端
              </div>
              <div class="text-blue-300 text-[10px] opacity-70 tracking-widest">
                HOSPITAL SELF-SERVICE KIOSK
              </div>
            </div>
          </div>
          <div class="flex items-center gap-5">
            <div class="flex items-center gap-1.5">
              <svg
                class="w-3 h-3 text-blue-300"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="2" y="3" width="20" height="14" rx="2" />
                <path d="M8 21h8M12 17v4" stroke-linecap="round" />
              </svg>
              <div>
                <div class="text-blue-400 text-[9px] uppercase tracking-widest">
                  终端
                </div>
                <div class="text-white mono text-[11px] font-medium">
                  KSK-001
                </div>
              </div>
            </div>
            <div class="w-px h-6 bg-white/10"></div>
            <div class="flex items-center gap-1.5">
              <svg
                class="w-3 h-3 text-blue-300"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10" />
                <path d="M2 12h20M12 2a15.3 15.3 0 010 20" />
              </svg>
              <div>
                <div class="text-blue-400 text-[9px] uppercase tracking-widest">
                  IP
                </div>
                <div class="text-white mono text-[11px] font-medium">
                  192.168.1.100
                </div>
              </div>
            </div>
            <div class="w-px h-6 bg-white/10"></div>
            <div class="flex items-center gap-1.5">
              <div
                class="relative w-3.5 h-3.5 flex items-center justify-center"
              >
                <span
                  class="absolute w-3.5 h-3.5 rounded-full bg-emerald-400 opacity-30 pulse-dot"
                ></span>
                <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
              </div>
              <div>
                <div class="text-blue-400 text-[9px] uppercase tracking-widest">
                  状态
                </div>
                <div class="text-emerald-400 text-[11px] font-medium">
                  运行正常
                </div>
              </div>
            </div>
            <div class="w-px h-6 bg-white/10 hidden sm:block"></div>
            <div class="hidden sm:block text-right">
              <div class="text-white mono text-sm font-medium">
                {{ currentTime }}
              </div>
              <div class="text-blue-400 text-[10px]">{{ currentDate }}</div>
            </div>
          </div>
        </div>
      </header>

      <!-- ══════════════ 主体 ══════════════ -->
      <main
        class="bg-grid min-h-screen flex items-start justify-center px-4 py-10"
      >
        <div class="w-full max-w-md slide-up">
          <div class="login-card rounded-3xl overflow-hidden">
            <div class="card-accent h-1.5 w-full"></div>
            <div class="px-8 pt-8 pb-10">
              <!-- 欢迎 -->
              <div class="text-center mb-7">
                <div
                  class="inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-blue-50 border border-blue-100 mb-3"
                >
                  <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="8" r="4" fill="#3b82f6" opacity=".9" />
                    <path
                      d="M4 20c0-4 3.58-7 8-7s8 3 8 7"
                      stroke="#3b82f6"
                      stroke-width="2"
                      stroke-linecap="round"
                      opacity=".6"
                    />
                  </svg>
                </div>
                <h1 class="text-xl font-bold text-gray-800 tracking-tight">
                  员工身份验证
                </h1>
                <p class="text-sm text-gray-400 mt-1">点击输入框唤起虚拟键盘</p>
              </div>

              <!-- Tab -->
              <div class="flex rounded-xl bg-gray-100 p-1 gap-1 mb-7">
                <button
                  v-for="t in tabs"
                  :key="t.id"
                  @click="activeTab = t.id; closeKeyboard()"
                  class="tab-btn flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg text-sm font-medium"
                  :class="activeTab === t.id ? 'active' : 'text-gray-500 hover:text-gray-700'"
                >
                  <span v-html="t.icon" class="w-3.5 h-3.5 flex-shrink-0"></span
                  >{{ t.label }}
                </button>
              </div>

              <!-- ── 密码登录 ── -->
              <div v-if="activeTab === 'password'">
                <!-- 工号 -->
                <div class="mb-4">
                  <label
                    class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2"
                    >员工工号</label
                  >
                  <div class="relative" @click="openKeyboard('staffId','text')">
                    <div
                      class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"
                    >
                      <svg
                        width="15"
                        height="15"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                      >
                        <circle cx="12" cy="8" r="4" />
                        <path d="M4 20c0-4 3.58-7 8-7s8 3 8 7" />
                      </svg>
                    </div>
                    <div
                      class="kiosk-input w-full pl-10 pr-10 py-4 rounded-xl text-gray-800 text-sm font-medium min-h-[3.5rem] flex items-center"
                      :class="{ focused: activeField === 'staffId' }"
                    >
                      <span
                        v-if="formVals.staffId"
                        class="mono text-gray-800"
                        :class="{ 'input-cursor': activeField === 'staffId' }"
                        >{{ formVals.staffId }}</span
                      >
                      <span
                        v-else
                        class="text-gray-400"
                        :class="{ 'input-cursor': activeField === 'staffId' && !formVals.staffId }"
                        >{{ activeField === 'staffId' ? '' : '请输入员工工号'
                        }}</span
                      >
                    </div>
                    <button
                      v-if="formVals.staffId"
                      @click.stop="formVals.staffId = ''"
                      class="absolute right-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 transition-colors"
                    >
                      <svg
                        width="10"
                        height="10"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="3"
                        stroke-linecap="round"
                      >
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                      </svg>
                    </button>
                  </div>
                </div>

                <!-- 密码 -->
                <div class="mb-6">
                  <div class="flex justify-between items-center mb-2">
                    <label
                      class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest"
                      >登录密码</label
                    >
                    <button
                      class="text-xs text-blue-500 hover:text-blue-700 font-medium"
                    >
                      忘记密码？
                    </button>
                  </div>
                  <div
                    class="relative"
                    @click="openKeyboard('password','password')"
                  >
                    <div
                      class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"
                    >
                      <svg
                        width="15"
                        height="15"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                      >
                        <rect x="3" y="11" width="18" height="11" rx="2" />
                        <path d="M7 11V7a5 5 0 0110 0v4" />
                      </svg>
                    </div>
                    <div
                      class="kiosk-input w-full pl-10 pr-10 py-4 rounded-xl text-gray-800 text-sm font-medium min-h-[3.5rem] flex items-center"
                      :class="{ focused: activeField === 'password' }"
                    >
                      <span v-if="formVals.password">
                        <span
                          v-if="showPwd"
                          class="mono text-gray-800"
                          :class="{ 'input-cursor': activeField === 'password' }"
                          >{{ formVals.password }}</span
                        >
                        <span
                          v-else
                          class="tracking-widest text-gray-600 text-base"
                          :class="{ 'input-cursor': activeField === 'password' }"
                          >{{ '●'.repeat(formVals.password.length) }}</span
                        >
                      </span>
                      <span
                        v-else
                        class="text-gray-400"
                        :class="{ 'input-cursor': activeField === 'password' && !formVals.password }"
                        >{{ activeField === 'password' ? '' : '请输入登录密码'
                        }}</span
                      >
                    </div>
                    <button
                      @click.stop="showPwd = !showPwd"
                      class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
                    >
                      <svg
                        v-if="!showPwd"
                        width="15"
                        height="15"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                      >
                        <path
                          d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                        />
                        <circle cx="12" cy="12" r="3" />
                      </svg>
                      <svg
                        v-else
                        width="15"
                        height="15"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                      >
                        <path
                          d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24M1 1l22 22"
                        />
                      </svg>
                    </button>
                  </div>
                </div>

                <!-- 字数提示 -->
                <div class="flex justify-between mb-4 -mt-4 px-1">
                  <span class="text-[11px] text-gray-400"
                    >{{ formVals.staffId ? '工号已填写' : '工号未填写' }}</span
                  >
                  <span class="text-[11px] text-gray-400"
                    >{{ formVals.password ? `已输入 ${formVals.password.length}
                    位` : '密码未填写' }}</span
                  >
                </div>

                <!-- 错误 -->
                <div
                  v-if="errorMsg"
                  class="mb-4 px-4 py-3 bg-red-50 border border-red-100 rounded-xl flex items-center gap-2.5"
                  :class="{ shake: shakeError }"
                >
                  <svg
                    class="w-4 h-4 text-red-500 flex-shrink-0"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <line x1="12" y1="8" x2="12" y2="12" />
                    <line x1="12" y1="16" x2="12.01" y2="16" />
                  </svg>
                  <span class="text-sm text-red-600 font-medium"
                    >{{ errorMsg }}</span
                  >
                </div>

                <!-- 按钮 -->
                <button
                  @click="handleLogin"
                  :disabled="!formVals.staffId || !formVals.password || isLoading"
                  class="btn-login w-full py-4 rounded-xl text-white font-bold text-sm tracking-wider flex items-center justify-center gap-2.5"
                >
                  <svg
                    v-if="isLoading"
                    class="spinner w-4 h-4"
                    viewBox="0 0 24 24"
                    fill="none"
                  >
                    <circle
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="rgba(255,255,255,.3)"
                      stroke-width="3"
                    />
                    <path
                      d="M12 2a10 10 0 019.78 12"
                      stroke="white"
                      stroke-width="3"
                      stroke-linecap="round"
                    />
                  </svg>
                  <span>{{ isLoading ? '验证中...' : '立即登录' }}</span>
                  <svg
                    v-if="!isLoading"
                    width="15"
                    height="15"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="white"
                    stroke-width="2.5"
                    stroke-linecap="round"
                  >
                    <path d="M5 12h14M12 5l7 7-7 7" />
                  </svg>
                </button>
                <p class="text-center text-[11px] text-gray-400 mt-3">
                  Demo：任意工号 + 密码
                  <span
                    class="mono bg-gray-100 px-1.5 py-0.5 rounded text-gray-500"
                    >123456</span
                  >
                </p>
              </div>

              <!-- ── 员工卡 ── -->
              <div v-if="activeTab === 'card'">
                <div
                  @click="simulateCard"
                  class="nfc-zone rounded-2xl p-10 flex flex-col items-center gap-5 cursor-pointer select-none mb-5"
                  :class="{'!border-green-300':cardStatus==='success','!border-red-300':cardStatus==='error'}"
                >
                  <div
                    v-if="cardStatus==='waiting'"
                    class="relative flex items-center justify-center"
                  >
                    <div
                      v-for="i in 3"
                      :key="i"
                      class="absolute w-20 h-20 rounded-full border-2 border-blue-300 nfc-ring"
                    ></div>
                    <div
                      class="w-16 h-16 rounded-2xl bg-blue-100 flex items-center justify-center z-10"
                    >
                      <svg
                        width="30"
                        height="30"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="#3b82f6"
                        stroke-width="1.5"
                        stroke-linecap="round"
                      >
                        <path
                          d="M6 9a6 6 0 0012 0M6 15a6 6 0 0012 0M3 12h18M12 3v18"
                        />
                        <rect
                          x="8"
                          y="8"
                          width="8"
                          height="8"
                          rx="2"
                          fill="#3b82f6"
                          opacity=".12"
                        />
                      </svg>
                    </div>
                  </div>
                  <div
                    v-if="cardStatus==='reading'"
                    class="w-16 h-16 rounded-2xl bg-blue-100 flex items-center justify-center"
                  >
                    <svg
                      class="spinner w-8 h-8 text-blue-500"
                      viewBox="0 0 24 24"
                      fill="none"
                    >
                      <circle
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="#dbeafe"
                        stroke-width="3"
                      />
                      <path
                        d="M12 2a10 10 0 019.78 12"
                        stroke="#3b82f6"
                        stroke-width="3"
                        stroke-linecap="round"
                      />
                    </svg>
                  </div>
                  <div
                    v-if="cardStatus==='success'"
                    class="w-16 h-16 rounded-2xl bg-green-100 flex items-center justify-center"
                  >
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
                      <circle cx="12" cy="12" r="10" fill="#dcfce7" />
                      <path
                        d="M7 13l3 3 7-7"
                        stroke="#22c55e"
                        stroke-width="2.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </div>
                  <div
                    v-if="cardStatus==='error'"
                    class="w-16 h-16 rounded-2xl bg-red-100 flex items-center justify-center"
                  >
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
                      <circle cx="12" cy="12" r="10" fill="#fee2e2" />
                      <line
                        x1="15"
                        y1="9"
                        x2="9"
                        y2="15"
                        stroke="#ef4444"
                        stroke-width="2.5"
                        stroke-linecap="round"
                      />
                      <line
                        x1="9"
                        y1="9"
                        x2="15"
                        y2="15"
                        stroke="#ef4444"
                        stroke-width="2.5"
                        stroke-linecap="round"
                      />
                    </svg>
                  </div>
                  <div class="text-center">
                    <p
                      class="font-semibold text-sm"
                      :class="{'text-blue-600':cardStatus==='waiting','text-blue-700':cardStatus==='reading','text-green-600':cardStatus==='success','text-red-500':cardStatus==='error'}"
                    >
                      {{
                      {'waiting':'请将员工卡靠近感应区','reading':'正在读取卡片信息...','success':'读卡成功，正在验证...','error':'读卡失败，请重试'}[cardStatus]
                      }}
                    </p>
                    <p
                      v-if="cardStatus==='waiting'"
                      class="text-xs text-gray-400 mt-1"
                    >
                      点击区域模拟刷卡
                    </p>
                  </div>
                </div>
                <div class="flex items-center gap-3 mb-4">
                  <div class="flex-1 h-px bg-gray-200"></div>
                  <span class="text-xs text-gray-400">或手动输入卡号</span>
                  <div class="flex-1 h-px bg-gray-200"></div>
                </div>
                <div
                  class="relative"
                  @click="openKeyboard('cardNumber','text')"
                >
                  <div
                    class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"
                  >
                    <svg
                      width="15"
                      height="15"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="2" y="5" width="20" height="14" rx="2" />
                      <line x1="2" y1="10" x2="22" y2="10" />
                    </svg>
                  </div>
                  <div
                    class="kiosk-input w-full pl-10 pr-4 py-4 rounded-xl text-sm mono min-h-[3.5rem] flex items-center"
                    :class="{ focused: activeField === 'cardNumber' }"
                  >
                    <span
                      v-if="formVals.cardNumber"
                      class="text-gray-800"
                      :class="{ 'input-cursor': activeField === 'cardNumber' }"
                      >{{ formVals.cardNumber }}</span
                    >
                    <span
                      v-else
                      class="text-gray-400"
                      :class="{ 'input-cursor': activeField === 'cardNumber' && !formVals.cardNumber }"
                      >{{ activeField === 'cardNumber' ? '' : 'EMP-202401-001'
                      }}</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="text-center mt-5">
            <p class="text-xs text-gray-400">
              IT 服务台 <span class="text-blue-500 font-medium">ext. 8888</span>
            </p>
            <p class="text-[10px] text-gray-300 mt-1">
              © 2025 医院信息中心 · v2.4.1
            </p>
          </div>
        </div>
      </main>

      <!-- ══════════════ 键盘遮罩 ══════════════ -->
      <transition name="fade">
        <div
          v-if="kbVisible"
          class="kb-overlay fixed inset-0 z-40"
          @click="closeKeyboard"
        ></div>
      </transition>

      <!-- ══════════════ 虚拟键盘 ══════════════ -->
      <transition name="kb">
        <div v-if="kbVisible" class="keyboard-shell z-50" ref="kbRef">
          <!-- 把手 + 顶栏 -->
          <div class="keyboard-topbar px-4 pb-3">
            <div class="drag-handle"></div>
            <div class="flex items-center justify-between mt-3">
              <!-- 输入预览 -->
              <div
                class="input-preview px-3 py-1.5 flex items-center gap-2 flex-1 mr-3 min-w-0"
              >
                <svg
                  class="w-3 h-3 text-gray-500 flex-shrink-0"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                >
                  <template v-if="activeInputType==='password'">
                    <rect x="3" y="11" width="18" height="11" rx="2" />
                    <path d="M7 11V7a5 5 0 0110 0v4" />
                  </template>
                  <template v-else>
                    <circle cx="12" cy="8" r="4" />
                    <path d="M4 20c0-4 3.58-7 8-7s8 3 8 7" />
                  </template>
                </svg>
                <span
                  class="text-xs text-gray-300 truncate mono flex-1 min-w-0"
                >
                  <template v-if="!currentVal">
                    <span class="text-gray-600 italic"
                      >{{ activeField === 'staffId' ? '员工工号' : activeField
                      === 'password' ? '登录密码' : '员工卡号' }}</span
                    >
                  </template>
                  <template v-else>
                    <span v-if="activeInputType==='password'"
                      >{{ '●'.repeat(currentVal.length) }}</span
                    >
                    <span v-else>{{ currentVal }}</span>
                  </template>
                </span>
                <span class="text-[10px] text-gray-600 flex-shrink-0 mono"
                  >{{ currentVal.length }}</span
                >
              </div>
              <!-- 模式标签 -->
              <div
                class="mode-pill flex-shrink-0 mr-3"
                :class="{ 'mode-alpha': kbMode.startsWith('alpha'), 'mode-number': kbMode==='number', 'mode-symbol': kbMode==='symbol' }"
              >
                {{ { 'alpha-lower':'ABC', 'alpha-upper':'ABC', 'number':'123',
                'symbol':'#@!' }[kbMode] }}
              </div>
              <!-- 关闭 -->
              <button
                @click="closeKeyboard"
                class="w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors flex-shrink-0"
              >
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="white"
                  stroke-width="2.5"
                  stroke-linecap="round"
                >
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
              </button>
            </div>
          </div>

          <!-- 键区 -->
          <div class="px-2.5 pb-4 pt-2">
            <transition name="mode">
              <!-- ── 字母键盘 ── -->
              <div
                v-if="kbMode === 'alpha-lower' || kbMode === 'alpha-upper'"
                :key="kbMode"
              >
                <!-- Row 1 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: repeat(10, 1fr)"
                >
                  <button
                    v-for="k in alphaRows[0]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-char h-12"
                    :class="{ pressing: pressedKey === k }"
                  >
                    {{ kbMode==='alpha-upper' ? k.toUpperCase() : k }}
                  </button>
                </div>
                <!-- Row 2 (9 keys centered) -->
                <div class="flex justify-center gap-1.5 mb-1.5">
                  <button
                    v-for="k in alphaRows[1]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-char h-12"
                    style="width: calc(10% - 3px)"
                    :class="{ pressing: pressedKey === k }"
                  >
                    {{ kbMode==='alpha-upper' ? k.toUpperCase() : k }}
                  </button>
                </div>
                <!-- Row 3 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: 1.6fr repeat(7, 1fr) 1.6fr"
                >
                  <button
                    @click="pressShift"
                    @mousedown.prevent
                    class="key key-fn h-12 flex items-center justify-center gap-1"
                    :class="{ 'key-shift-active': shiftMode==='once', 'key-shift-caps': shiftMode==='caps' }"
                  >
                    <svg width="14" height="14" viewBox="0 0 24 24">
                      <path
                        v-if="shiftMode==='caps'"
                        d="M12 4l8 8h-4v8H8v-8H4z"
                        fill="currentColor"
                      />
                      <path
                        v-else
                        d="M12 4l8 8h-4v8H8v-8H4z"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linejoin="round"
                      />
                    </svg>
                    <span class="text-[10px]"
                      >{{ shiftMode==='caps' ? '⇪' : '⇧' }}</span
                    >
                  </button>
                  <button
                    v-for="k in alphaRows[2]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-char h-12"
                    :class="{ pressing: pressedKey === k }"
                  >
                    {{ kbMode==='alpha-upper' ? k.toUpperCase() : k }}
                  </button>
                  <button
                    @mousedown.prevent
                    @mousedown="startBackspace"
                    @mouseup="stopBackspace"
                    @mouseleave="stopBackspace"
                    @touchstart.prevent="startBackspace"
                    @touchend="stopBackspace"
                    class="key key-fn h-12"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    >
                      <path
                        d="M21 4H8l-7 8 7 8h13a2 2 0 002-2V6a2 2 0 00-2-2z"
                      />
                      <line x1="18" y1="9" x2="12" y2="15" />
                      <line x1="12" y1="9" x2="18" y2="15" />
                    </svg>
                  </button>
                </div>
                <!-- Row 4 -->
                <div
                  class="grid gap-1.5"
                  style="grid-template-columns: 2fr 2fr 4fr 2.5fr"
                >
                  <button
                    @click="switchMode('number')"
                    @mousedown.prevent
                    class="key key-fn h-14 text-xs font-bold tracking-wider"
                  >
                    123
                  </button>
                  <button
                    @click="switchMode('symbol')"
                    @mousedown.prevent
                    class="key key-fn h-14 text-xs font-bold"
                  >
                    #&@
                  </button>
                  <button
                    @click="pressKey(' ')"
                    @mousedown.prevent
                    class="key key-space h-14 text-[10px] tracking-[.15em]"
                  >
                    SPACE
                  </button>
                  <button
                    @click="pressConfirm"
                    @mousedown.prevent
                    class="key key-confirm h-14"
                  >
                    确认
                  </button>
                </div>
              </div>

              <!-- ── 数字键盘 ── -->
              <div v-else-if="kbMode === 'number'" key="number">
                <!-- Row 1 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: repeat(10, 1fr)"
                >
                  <button
                    v-for="k in numRows[0]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-num h-12"
                  >
                    {{ k }}
                  </button>
                </div>
                <!-- Row 2 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: repeat(10, 1fr)"
                >
                  <button
                    v-for="k in numRows[1]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-fn h-12 text-sm"
                  >
                    {{ k }}
                  </button>
                </div>
                <!-- Row 3 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: 1.6fr repeat(5, 1fr) 1.6fr"
                >
                  <button
                    @click="switchMode('alpha-lower')"
                    @mousedown.prevent
                    class="key key-fn h-12 text-xs font-bold tracking-wider"
                  >
                    ABC
                  </button>
                  <button
                    v-for="k in numRows[2]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-fn h-12 text-sm"
                  >
                    {{ k }}
                  </button>
                  <button
                    @mousedown.prevent
                    @mousedown="startBackspace"
                    @mouseup="stopBackspace"
                    @mouseleave="stopBackspace"
                    @touchstart.prevent="startBackspace"
                    @touchend="stopBackspace"
                    class="key key-fn h-12"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    >
                      <path
                        d="M21 4H8l-7 8 7 8h13a2 2 0 002-2V6a2 2 0 00-2-2z"
                      />
                      <line x1="18" y1="9" x2="12" y2="15" />
                      <line x1="12" y1="9" x2="18" y2="15" />
                    </svg>
                  </button>
                </div>
                <!-- Row 4 -->
                <div
                  class="grid gap-1.5"
                  style="grid-template-columns: 2fr 4fr 2.5fr"
                >
                  <button
                    @click="switchMode('symbol')"
                    @mousedown.prevent
                    class="key key-fn h-14 text-xs font-bold"
                  >
                    #@!
                  </button>
                  <button
                    @click="pressKey(' ')"
                    @mousedown.prevent
                    class="key key-space h-14 text-[10px] tracking-[.15em]"
                  >
                    SPACE
                  </button>
                  <button
                    @click="pressConfirm"
                    @mousedown.prevent
                    class="key key-confirm h-14"
                  >
                    确认
                  </button>
                </div>
              </div>

              <!-- ── 特殊字符 ── -->
              <div v-else-if="kbMode === 'symbol'" key="symbol">
                <!-- Row 1 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: repeat(10, 1fr)"
                >
                  <button
                    v-for="k in symRows[0]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-sym h-12 text-sm"
                    :title="k"
                  >
                    {{ k }}
                  </button>
                </div>
                <!-- Row 2 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: repeat(10, 1fr)"
                >
                  <button
                    v-for="k in symRows[1]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-sym h-12 text-sm"
                    :title="k"
                  >
                    {{ k }}
                  </button>
                </div>
                <!-- Row 3 -->
                <div
                  class="grid gap-1.5 mb-1.5"
                  style="grid-template-columns: 1.6fr repeat(5, 1fr) 1.6fr"
                >
                  <button
                    @click="switchMode('alpha-lower')"
                    @mousedown.prevent
                    class="key key-fn h-12 text-xs font-bold tracking-wider"
                  >
                    ABC
                  </button>
                  <button
                    v-for="k in symRows[2]"
                    :key="k"
                    @click="pressKey(k)"
                    @mousedown.prevent
                    class="key key-fn h-12 text-sm"
                  >
                    {{ k }}
                  </button>
                  <button
                    @mousedown.prevent
                    @mousedown="startBackspace"
                    @mouseup="stopBackspace"
                    @mouseleave="stopBackspace"
                    @touchstart.prevent="startBackspace"
                    @touchend="stopBackspace"
                    class="key key-fn h-12"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                    >
                      <path
                        d="M21 4H8l-7 8 7 8h13a2 2 0 002-2V6a2 2 0 00-2-2z"
                      />
                      <line x1="18" y1="9" x2="12" y2="15" />
                      <line x1="12" y1="9" x2="18" y2="15" />
                    </svg>
                  </button>
                </div>
                <!-- Row 4 -->
                <div
                  class="grid gap-1.5"
                  style="grid-template-columns: 2fr 4fr 2.5fr"
                >
                  <button
                    @click="switchMode('number')"
                    @mousedown.prevent
                    class="key key-fn h-14 text-xs font-bold tracking-wider"
                  >
                    123
                  </button>
                  <button
                    @click="pressKey(' ')"
                    @mousedown.prevent
                    class="key key-space h-14 text-[10px] tracking-[.15em]"
                  >
                    SPACE
                  </button>
                  <button
                    @click="pressConfirm"
                    @mousedown.prevent
                    class="key key-confirm h-14"
                  >
                    确认
                  </button>
                </div>
              </div>
            </transition>
          </div>
        </div>
      </transition>

      <!-- ══════════════ 登录成功弹窗 ══════════════ -->
      <div
        v-if="showSuccess"
        class="fixed inset-0 z-[200] flex items-center justify-center bg-black/40 backdrop-blur-sm"
      >
        <div
          class="bg-white rounded-3xl p-10 max-w-sm w-full mx-4 text-center shadow-2xl popup-in"
        >
          <div
            class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4"
          >
            <svg width="38" height="38" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" fill="#dcfce7" />
              <path
                d="M7 13l3 3 7-7"
                stroke="#22c55e"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
          <h2 class="text-xl font-bold text-gray-800 mb-1.5">登录成功</h2>
          <p class="text-gray-500 text-sm mb-1">
            欢迎，<span class="text-blue-600 font-bold"
              >{{ formVals.staffId }}</span
            >
          </p>
          <p class="text-gray-400 text-xs mb-5">正在跳转至工作台...</p>
          <div class="h-1 bg-gray-100 rounded-full overflow-hidden">
            <div
              class="h-full bg-green-400 rounded-full"
              style="animation: loadBar 2s linear forwards"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <style>
      .fade-enter-active,
      .fade-leave-active {
        transition: opacity 0.2s;
      }
      .fade-enter-from,
      .fade-leave-to {
        opacity: 0;
      }
      @keyframes loadBar {
        from {
          width: 0;
        }
        to {
          width: 100%;
        }
      }
    </style>

    <script>
      const {
        createApp,
        ref,
        computed,
        watch,
        onMounted,
        onUnmounted,
        nextTick,
      } = Vue;

      createApp({
        setup() {
          // ── 时钟 ──
          const currentTime = ref("");
          const currentDate = ref("");
          const updateClock = () => {
            const n = new Date();
            currentTime.value = n.toLocaleTimeString("zh-CN", {
              hour12: false,
            });
            currentDate.value = n.toLocaleDateString("zh-CN", {
              year: "numeric",
              month: "2-digit",
              day: "2-digit",
              weekday: "short",
            });
          };
          let clockTimer;

          // ── Tab ──
          const tabs = [
            {
              id: "password",
              label: "密码登录",
              icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>`,
            },
            {
              id: "card",
              label: "员工卡登录",
              icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>`,
            },
          ];
          const activeTab = ref("password");

          // ── 表单 ──
          const formVals = ref({ staffId: "", password: "", cardNumber: "" });
          const showPwd = ref(false);
          const isLoading = ref(false);
          const errorMsg = ref("");
          const shakeError = ref(false);
          const showSuccess = ref(false);

          const triggerShake = () => {
            shakeError.value = false;
            nextTick(() => {
              shakeError.value = true;
              setTimeout(() => (shakeError.value = false), 400);
            });
          };

          const handleLogin = async () => {
            if (!formVals.value.staffId || !formVals.value.password) return;
            if (formVals.value.password !== "123456") {
              errorMsg.value = "工号或密码不正确，请重试";
              triggerShake();
              return;
            }
            isLoading.value = true;
            errorMsg.value = "";
            await new Promise((r) => setTimeout(r, 1500));
            isLoading.value = false;
            showSuccess.value = true;
            setTimeout(() => {
              showSuccess.value = false;
              formVals.value = { staffId: "", password: "", cardNumber: "" };
            }, 2800);
          };

          // ── NFC ──
          const cardStatus = ref("waiting");
          const simulateCard = () => {
            if (cardStatus.value !== "waiting") return;
            cardStatus.value = "reading";
            setTimeout(() => {
              cardStatus.value = Math.random() > 0.3 ? "success" : "error";
              if (cardStatus.value === "success") {
                showSuccess.value = true;
                formVals.value.staffId = "EMP20240108";
                setTimeout(() => {
                  showSuccess.value = false;
                  cardStatus.value = "waiting";
                }, 2800);
              } else {
                setTimeout(() => {
                  cardStatus.value = "waiting";
                }, 3000);
              }
            }, 1800);
          };

          // ════════════════════════════════════════
          // ── 虚拟键盘 ──
          // ════════════════════════════════════════
          const kbVisible = ref(false);
          const kbMode = ref("alpha-lower"); // alpha-lower | alpha-upper | number | symbol
          const kbHeight = ref(280);
          const kbRef = ref(null);
          const activeField = ref(null);
          const activeInputType = ref("text");
          const shiftMode = ref("off"); // off | once | caps
          const pressedKey = ref(null);

          const currentVal = computed(
            () => formVals.value[activeField.value] || "",
          );

          // 键位数据
          const alphaRows = [
            ["q", "w", "e", "r", "t", "y", "u", "i", "o", "p"],
            ["a", "s", "d", "f", "g", "h", "j", "k", "l"],
            ["z", "x", "c", "v", "b", "n", "m"],
          ];
          const numRows = [
            ["1", "2", "3", "4", "5", "6", "7", "8", "9", "0"],
            ["-", "/", "(", ")", "$", "&", "@", '"', ":", ";"],
            [".", ",", "?", "!", "'", "_"],
          ];
          const symRows = [
            ["[", "]", "{", "}", "#", "%", "^", "*", "+", "="],
            ["_", "\\", "|", "~", "<", ">", "€", "£", "¥", "•"],
            [".", ",", "?", "!", "'", "`"],
          ];

          // AudioContext 点击音效
          let audioCtx = null;
          const playClick = (freq = 780, dur = 0.045) => {
            try {
              if (!audioCtx)
                audioCtx = new (
                  window.AudioContext || window.webkitAudioContext
                )();
              const o = audioCtx.createOscillator();
              const g = audioCtx.createGain();
              o.connect(g);
              g.connect(audioCtx.destination);
              o.frequency.value = freq;
              o.type = "sine";
              g.gain.setValueAtTime(0.06, audioCtx.currentTime);
              g.gain.exponentialRampToValueAtTime(
                0.001,
                audioCtx.currentTime + dur,
              );
              o.start();
              o.stop(audioCtx.currentTime + dur);
            } catch (e) {}
          };

          const openKeyboard = (field, type = "text") => {
            activeField.value = field;
            activeInputType.value = type;
            kbVisible.value = true;
            // number 输入默认数字模式
            if (type === "number") kbMode.value = "number";
            else if (kbMode.value === "number" || kbMode.value === "symbol")
              kbMode.value = "alpha-lower";
            nextTick(() => {
              if (kbRef.value) kbHeight.value = kbRef.value.offsetHeight;
            });
          };

          const closeKeyboard = () => {
            kbVisible.value = false;
            activeField.value = null;
          };

          // 计算键盘高度（transition 结束后更新）
          watch(kbVisible, (v) => {
            if (v) {
              nextTick(() => {
                setTimeout(() => {
                  if (kbRef.value) kbHeight.value = kbRef.value.offsetHeight;
                }, 50);
              });
            }
          });

          const switchMode = (mode) => {
            kbMode.value = mode;
            playClick(600, 0.04);
          };

          const pressShift = () => {
            playClick(900, 0.04);
            if (shiftMode.value === "off") {
              shiftMode.value = "once";
              kbMode.value = "alpha-upper";
            } else if (shiftMode.value === "once") {
              shiftMode.value = "caps";
              kbMode.value = "alpha-upper";
            } else {
              shiftMode.value = "off";
              kbMode.value = "alpha-lower";
            }
          };

          const pressKey = (k) => {
            if (!activeField.value) return;
            playClick();
            pressedKey.value = k;
            setTimeout(() => {
              pressedKey.value = null;
            }, 100);

            let char = k;
            if (
              kbMode.value === "alpha-upper" &&
              k.length === 1 &&
              k.match(/[a-z]/i)
            ) {
              char = k.toUpperCase();
            }
            formVals.value[activeField.value] += char;

            // one-shot shift: 输入一个字母后自动切回小写
            if (shiftMode.value === "once") {
              shiftMode.value = "off";
              kbMode.value = "alpha-lower";
            }
            errorMsg.value = "";
          };

          const pressConfirm = () => {
            playClick(1000, 0.06);
            if (activeField.value === "staffId") {
              openKeyboard("password", "password");
            } else {
              closeKeyboard();
              if (activeTab.value === "password") handleLogin();
            }
          };

          // 长按退格
          let bsTimer = null;
          let bsInterval = null;
          const doBackspace = () => {
            if (!activeField.value) return;
            playClick(500, 0.035);
            formVals.value[activeField.value] = formVals.value[
              activeField.value
            ].slice(0, -1);
          };
          const startBackspace = () => {
            doBackspace();
            bsTimer = setTimeout(() => {
              bsInterval = setInterval(doBackspace, 80);
            }, 480);
          };
          const stopBackspace = () => {
            clearTimeout(bsTimer);
            clearInterval(bsInterval);
          };

          // 滑动关闭键盘
          let touchStartY = 0;
          const onTouchStart = (e) => {
            touchStartY = e.touches[0].clientY;
          };
          const onTouchEnd = (e) => {
            const dy = e.changedTouches[0].clientY - touchStartY;
            if (dy > 50 && kbVisible.value) closeKeyboard();
          };

          onMounted(() => {
            updateClock();
            clockTimer = setInterval(updateClock, 1000);
            document.addEventListener("touchstart", onTouchStart, {
              passive: true,
            });
            document.addEventListener("touchend", onTouchEnd, {
              passive: true,
            });
          });
          onUnmounted(() => {
            clearInterval(clockTimer);
            document.removeEventListener("touchstart", onTouchStart);
            document.removeEventListener("touchend", onTouchEnd);
          });

          return {
            currentTime,
            currentDate,
            tabs,
            activeTab,
            formVals,
            showPwd,
            isLoading,
            errorMsg,
            shakeError,
            showSuccess,
            handleLogin,
            cardStatus,
            simulateCard,
            kbVisible,
            kbMode,
            kbHeight,
            kbRef,
            activeField,
            activeInputType,
            shiftMode,
            pressedKey,
            currentVal,
            alphaRows,
            numRows,
            symRows,
            openKeyboard,
            closeKeyboard,
            switchMode,
            pressShift,
            pressKey,
            pressConfirm,
            startBackspace,
            stopBackspace,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
